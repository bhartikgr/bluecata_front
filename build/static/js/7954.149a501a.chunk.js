"use strict";(self.webpackChunkkeiretsuproject=self.webpackChunkkeiretsuproject||[]).push([[7954],{77954:(e,s,t)=>{t.r(s),t.d(s,{default:()=>m});var a=t(65043),n=t(94060),r=t(44710),i=(t(38421),t(70579));const c=e=>{var s;let{show:t,onClose:a,roundData:n,investors:r,countrySymbolList:c,onUpdateStatus:l}=e;if(!t)return null;const d=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";if(!e||isNaN(parseFloat(e)))return"$0.00";const t=parseFloat(e);let a=s;s&&(a=s.replace(/[\$\u20ac\xa3\xa5\u20b9\u20bd]/g,"").replace(/\s+/g,"").trim().toUpperCase());const n=null===c||void 0===c?void 0:c.find((e=>e.currency_code===a||e.currency_code===s||e.currency_symbol===s));if(n)try{return new Intl.NumberFormat("en-US",{style:"currency",currency:n.currency_code,minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}catch(r){return`${n.currency_symbol}${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}if(/^[A-Z]{3}$/.test(a))try{return new Intl.NumberFormat("en-US",{style:"currency",currency:a,minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}catch(r){console.warn(`Currency formatting error for ${s}:`,r)}return`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`},o=(null===r||void 0===r?void 0:r.reduce(((e,s)=>e+parseFloat(s.investment_amount||0)),0))||0,m=(null===r||void 0===r?void 0:r.reduce(((e,s)=>e+parseFloat(s.shares||0)),0))||0,h=m>0?o/m:0,u=(null===n||void 0===n?void 0:n.currency)||(null===(s=r[0])||void 0===s?void 0:s.currency)||"USD",x=e=>{const s={Yes:{class:"badge bg-success",text:"Confirmed"},No:{class:"badge bg-warning text-dark",text:"Pending"},Rejected:{class:"badge bg-danger",text:"Rejected"}},t=s[e]||s.No;return(0,i.jsx)("span",{className:t.class,children:t.text})},v=(e,s)=>e&&s&&0!==s?(parseFloat(e)/parseFloat(s)*100).toFixed(2):"0.00";return(0,i.jsx)("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",role:"dialog",children:(0,i.jsx)("div",{className:"modal-dialog modal-xl modal-dialog-centered",role:"document",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header bg-primary text-white",children:[(0,i.jsxs)("h5",{className:"modal-title",children:[(0,i.jsx)("i",{className:"fas fa-users me-2"}),(null===n||void 0===n?void 0:n.name)||"Round"," - Investors"]}),(0,i.jsx)("button",{type:"button",className:"btn-close btn-close-white",onClick:a,"aria-label":"Close"})]}),(0,i.jsxs)("div",{className:"modal-body",children:[(0,i.jsxs)("div",{className:"row mb-4",children:[(0,i.jsx)("div",{className:"col-md-3",children:(0,i.jsx)("div",{className:"card border-0 bg-light",children:(0,i.jsxs)("div",{className:"card-body text-center",children:[(0,i.jsx)("h6",{className:"text-muted",children:"Total Raised"}),(0,i.jsx)("h4",{className:"text-primary",children:d(o,u)})]})})}),(0,i.jsx)("div",{className:"col-md-3",children:(0,i.jsx)("div",{className:"card border-0 bg-light",children:(0,i.jsxs)("div",{className:"card-body text-center",children:[(0,i.jsx)("h6",{className:"text-muted",children:"Total Shares"}),(0,i.jsx)("h4",{className:"text-success",children:Math.round(m).toLocaleString()})]})})}),(0,i.jsx)("div",{className:"col-md-3",children:(0,i.jsx)("div",{className:"card border-0 bg-light",children:(0,i.jsxs)("div",{className:"card-body text-center",children:[(0,i.jsx)("h6",{className:"text-muted",children:"Price per Share"}),(0,i.jsxs)("h4",{className:"text-info",children:[u," ",h.toLocaleString(void 0,{minimumFractionDigits:3,maximumFractionDigits:3})]})]})})}),(0,i.jsx)("div",{className:"col-md-3",children:(0,i.jsx)("div",{className:"card border-0 bg-light",children:(0,i.jsxs)("div",{className:"card-body text-center",children:[(0,i.jsx)("h6",{className:"text-muted",children:"Total Investors"}),(0,i.jsx)("h4",{className:"text-warning",children:(null===r||void 0===r?void 0:r.length)||0})]})})})]}),(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)("table",{className:"table table-hover",children:[(0,i.jsx)("thead",{className:"table-dark",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Investor Name"}),(0,i.jsx)("th",{children:"Investment Amount"}),(0,i.jsx)("th",{children:"Shares"}),(0,i.jsx)("th",{children:"Ownership %"}),(0,i.jsx)("th",{children:"Status"}),(0,i.jsx)("th",{children:"Email"}),(0,i.jsx)("th",{children:"Phone"})]})}),(0,i.jsx)("tbody",{children:r&&0!==r.length?r.map((e=>{let s=parseFloat(e.shares||0);const t=parseFloat(e.investment_amount||0),a=(null===n||void 0===n?void 0:n.pricePerShare)||0;a>0&&t>0&&(s=t/a);const r=(null===n||void 0===n?void 0:n.issuedShares)||0,c=r>0?(s/r*100).toFixed(2):"0.00";return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:"fw-semibold",children:e.name||e.investor_name})}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:"fw-semibold",children:d(t,e.currency||u)})}),(0,i.jsxs)("td",{children:[(0,i.jsx)("div",{className:"fw-semibold",children:Math.round(s).toLocaleString()}),(0,i.jsxs)("div",{className:"text-muted small",children:[s.toFixed(1)," exact"]})]}),(0,i.jsxs)("td",{children:[(0,i.jsxs)("div",{className:"fw-semibold",children:[c,"%"]}),(0,i.jsxs)("div",{className:"text-muted small",children:["of ",Math.round(r).toLocaleString()," total shares"]})]}),(0,i.jsx)("td",{children:x(e.request_confirm)}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:"text-muted small",children:e.email||e.investor_email||"N/A"})}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:"text-muted small",children:e.phone||e.investor_phone||"N/A"})}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:"btn-group",role:"group",children:"No"===e.request_confirm&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{className:"btn btn-sm btn-success",onClick:()=>l(e.id,"Yes"),title:"Approve",children:(0,i.jsx)("i",{className:"fas fa-check"})}),(0,i.jsx)("button",{className:"btn btn-sm btn-danger",onClick:()=>l(e.id,"Rejected"),title:"Reject",children:(0,i.jsx)("i",{className:"fas fa-times"})})]})})})]},e.id)})):(0,i.jsx)("tr",{children:(0,i.jsxs)("td",{colSpan:"8",className:"text-center py-4",children:[(0,i.jsx)("i",{className:"fas fa-user-slash fa-2x text-muted mb-2"}),(0,i.jsx)("p",{className:"text-muted",children:"No investors found for this round"})]})})})]})})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsxs)("button",{type:"button",className:"btn btn-secondary",onClick:a,children:[(0,i.jsx)("i",{className:"fas fa-times me-1"})," Close"]}),(0,i.jsxs)("button",{type:"button",className:"btn btn-primary",onClick:()=>{if(!r||0===r.length)return void alert("No data to export");const e=[];e.push(["Investor Name","Email","Phone","Investment Amount","Shares","Ownership %","Status"]),r.forEach((s=>{const t=[s.name||s.investor_name||"",s.email||s.investor_email||"",s.phone||s.investor_phone||"",s.investment_amount||s.investmentAmount||0,s.shares||0,v(s.shares,m),s.request_confirm||""];e.push(t)}));const s=e.map((e=>e.map((e=>`"${e}"`)).join(","))).join("\n"),t=new Blob([s],{type:"text/csv"}),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`${(null===n||void 0===n?void 0:n.name)||"round"}_investors.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(a)},children:[(0,i.jsx)("i",{className:"fas fa-download me-1"})," Export to CSV"]})]})]})})})};var l=t(53579),d=t(73216),o=t(86213);function m(){(0,d.Zp)();const e=localStorage.getItem("SignatoryLoginData"),s=JSON.parse(e);document.title="Investor Portal";const[t,m]=(0,a.useState)([]),[h,u]=(0,a.useState)(!1),[x,v]=(0,a.useState)(!1),[j,p]=(0,a.useState)(null),[b,N]=(0,a.useState)({investments:[],stats:{totalInvestment:0,activeInvestments:0,totalShares:0,pendingRequests:0,confirmedInvestments:0,rejectedInvestments:0}}),[f,g]=(0,a.useState)({}),[y,I]=(0,a.useState)(!1),[S,w]=(0,a.useState)(null),[_,F]=(0,a.useState)([]),C="https://blueprintcatalyst.com/api/user/investor/";(0,a.useEffect)((()=>{k()}),[]),(0,a.useEffect)((()=>{R()}),[]);const k=async()=>{let e={id:""};try{const s=await o.A.post("https://blueprintcatalyst.com/api/user/capitalround/getallcountrySymbolList",e,{headers:{Accept:"application/json","Content-Type":"application/json"}});m(s.data.results||[])}catch(s){console.error("Error fetching currency list:",s)}},R=async()=>{v(!0),p(null);const e={company_id:s.companies[0].id};try{const s=await o.A.post(C+"fetchInvestorData",e,{headers:{Accept:"application/json","Content-Type":"application/json"}});if(s.data&&s.data.results){const e=(e=>{const s={},t={};return e.forEach((e=>{const s=e.roundrecord_id||e.nameOfRound;t[s]||(t[s]={totalInvestment:0,totalShares:parseFloat(e.issuedshares||0),investors:[]}),t[s].totalInvestment+=parseFloat(e.investment_amount||0),t[s].investors.push(e)})),e.forEach((e=>{const a=e.roundrecord_id||e.nameOfRound,n=e.nameOfRound||"Unnamed Round";if(!s[a]){s[a]={id:a,name:n,company_name:e.company_name,shareClassType:e.shareClassType,instrumentType:e.instrumentType,currency:e.currency||"USD",investors:[],totalInvestment:0,confirmedInvestment:0,totalShares:parseFloat(e.issuedshares||0),totalInvestors:0,confirmedInvestors:0,pendingInvestors:0,pricePerShare:0};const r=t[a];r.totalShares>0&&r.totalInvestment>0&&(s[a].pricePerShare=r.totalInvestment/r.totalShares)}let r=0;const i=parseFloat(e.investment_amount||0);i>0&&s[a].pricePerShare>0&&(r=i/s[a].pricePerShare);const c={id:e.id,investor_id:e.investor_id,name:e.investor_name,email:e.investor_email,phone:e.investor_phone,investment_amount:i,shares:r,request_confirm:e.request_confirm,instrumentType:e.instrumentType,currency:e.currency||"USD"};s[a].investors.push(c),s[a].totalInvestment+=i,s[a].totalInvestors++,"Yes"===c.request_confirm?(s[a].confirmedInvestment+=i,s[a].confirmedInvestors++):"No"===c.request_confirm&&s[a].pendingInvestors++})),s})(s.data.results);g(e),N({investments:s.data.results,stats:s.data.stats||{totalInvestment:0,activeInvestments:0,totalShares:0,pendingRequests:0,confirmedInvestments:0,rejectedInvestments:0}})}else p("No investment data found"),g({}),N({investments:[],stats:{totalInvestment:0,activeInvestments:0,totalShares:0,pendingRequests:0,confirmedInvestments:0,rejectedInvestments:0}})}catch(t){console.error("Error fetching investor data:",t),p("Failed to fetch investor data"),g({}),N({investments:[],stats:{totalInvestment:0,activeInvestments:0,totalShares:0,pendingRequests:0,confirmedInvestments:0,rejectedInvestments:0}})}finally{v(!1)}},D=e=>{const s=f[e];console.log("Round data for modal:",s),console.log("Issued shares:",null===s||void 0===s?void 0:s.issuedShares),console.log("Investors:",null===s||void 0===s?void 0:s.investors),s&&(w({id:s.id,name:s.name,company_name:s.company_name,shareClassType:s.shareClassType,instrumentType:s.instrumentType,currency:s.currency,pricePerShare:s.pricePerShare,issuedShares:s.issuedShares||s.totalShares,totalInvestment:s.totalInvestment}),F(s.investors),I(!0))},T=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";if(!e||isNaN(parseFloat(e)))return"$0.00";const a=parseFloat(e);let n=s;s&&(n=s.replace(/[\$\u20ac\xa3\xa5\u20b9\u20bd]/g,"").replace(/\s+/g,"").trim().toUpperCase());const r=t.find((e=>e.currency_code===n||e.currency_code===s||e.currency_symbol===s));if(r)try{return new Intl.NumberFormat("en-US",{style:"currency",currency:r.currency_code,minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}catch(j){return`${r.currency_symbol}${a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}if(/^[A-Z]{3}$/.test(n))try{return new Intl.NumberFormat("en-US",{style:"currency",currency:n,minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}catch(j){console.warn(`Currency formatting error for ${s}:`,j)}return`$${a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`};return(0,i.jsxs)(l.mO,{children:[(0,i.jsx)("div",{className:"fullpage d-block",children:(0,i.jsxs)("div",{className:"d-flex align-items-start gap-0",children:[(0,i.jsx)(r.A,{isCollapsed:h,setIsCollapsed:u}),(0,i.jsxs)("div",{className:"global_view "+(h?"global_view_col":""),children:[(0,i.jsx)(n.A,{}),(0,i.jsx)(l.$K,{className:"d-block p-md-4 p-3",children:(0,i.jsxs)("div",{className:"container-fluid",children:[(0,i.jsxs)("div",{className:"titleroom d-flex justify-content-between align-items-center border-bottom pb-3 mb-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-bold mb-1",children:"Investor Portal"}),(0,i.jsxs)("p",{className:"text-muted mb-0",children:["Company:"," ",s.companies&&s.companies[0]?s.companies[0].name:"N/A"]})]}),(0,i.jsxs)("div",{className:"text-end",children:[(0,i.jsx)("small",{className:"text-muted",children:"Total Rounds"}),(0,i.jsx)("h4",{className:"text-success mb-0",children:Object.keys(f).length})]})]}),(0,i.jsxs)("div",{className:"row g-3 mb-4",children:[(0,i.jsx)("div",{className:"col-md-3 col-6",children:(0,i.jsx)("div",{className:"card border-0 shadow-sm h-100",children:(0,i.jsx)("div",{className:"card-body",children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[(0,i.jsx)("div",{className:"rounded-circle bg-primary bg-opacity-10 p-3 me-3",children:(0,i.jsx)("i",{className:"fas fa-layer-group text-primary"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h6",{className:"card-subtitle mb-1 text-muted",children:"Total Rounds"}),(0,i.jsx)("h4",{className:"card-title mb-0",children:Object.keys(f).length})]})]})})})}),(0,i.jsx)("div",{className:"col-md-3 col-6",children:(0,i.jsx)("div",{className:"card border-0 shadow-sm h-100",children:(0,i.jsx)("div",{className:"card-body",children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[(0,i.jsx)("div",{className:"rounded-circle bg-success bg-opacity-10 p-3 me-3",children:(0,i.jsx)("i",{className:"fas fa-dollar-sign text-success"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h6",{className:"card-subtitle mb-1 text-muted",children:"Total Raised"}),(0,i.jsx)("h4",{className:"card-title mb-0",children:T(b.stats.totalInvestment)})]})]})})})}),(0,i.jsx)("div",{className:"col-md-3 col-6",children:(0,i.jsx)("div",{className:"card border-0 shadow-sm h-100",children:(0,i.jsx)("div",{className:"card-body",children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[(0,i.jsx)("div",{className:"rounded-circle bg-info bg-opacity-10 p-3 me-3",children:(0,i.jsx)("i",{className:"fas fa-users text-info"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h6",{className:"card-subtitle mb-1 text-muted",children:"Total Investors"}),(0,i.jsx)("h4",{className:"card-title mb-0",children:b.stats.confirmedInvestments+b.stats.pendingRequests})]})]})})})}),(0,i.jsx)("div",{className:"col-md-3 col-6",children:(0,i.jsx)("div",{className:"card border-0 shadow-sm h-100",children:(0,i.jsx)("div",{className:"card-body",children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[(0,i.jsx)("div",{className:"rounded-circle bg-warning bg-opacity-10 p-3 me-3",children:(0,i.jsx)("i",{className:"fas fa-clock text-warning"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h6",{className:"card-subtitle mb-1 text-muted",children:"Pending Requests"}),(0,i.jsx)("h4",{className:"card-title mb-0",children:b.stats.pendingRequests})]})]})})})})]}),(0,i.jsxs)("div",{className:"card shadow-sm",children:[(0,i.jsxs)("div",{className:"card-header bg-white d-flex justify-content-between align-items-center",children:[(0,i.jsxs)("h5",{className:"mb-0",children:[(0,i.jsx)("i",{className:"fas fa-chart-pie me-2"}),"Investment Rounds"]}),(0,i.jsxs)("button",{className:"btn btn-sm btn-outline-primary",onClick:R,disabled:x,children:[(0,i.jsx)("i",{className:"fas fa-sync-alt me-1"}),x?"Loading...":"Refresh"]})]}),(0,i.jsx)("div",{className:"card-body",children:x?(0,i.jsxs)("div",{className:"text-center py-5",children:[(0,i.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,i.jsx)("span",{className:"visually-hidden",children:"Loading..."})}),(0,i.jsx)("p",{className:"mt-3 text-muted",children:"Loading investment data..."})]}):j?(0,i.jsxs)("div",{className:"alert alert-warning text-center",children:[(0,i.jsx)("i",{className:"fas fa-exclamation-triangle fa-2x mb-3"}),(0,i.jsx)("h6",{children:"Error Loading Data"}),(0,i.jsx)("p",{children:j}),(0,i.jsx)("button",{className:"btn btn-sm btn-primary",onClick:R,children:"Try Again"})]}):(()=>{const e=Object.values(f);return 0===e.length?(0,i.jsxs)("div",{className:"text-center py-5",children:[(0,i.jsx)("i",{className:"fas fa-chart-pie fa-3x text-muted mb-3"}),(0,i.jsx)("h6",{children:"No Investment Rounds Found"}),(0,i.jsx)("p",{className:"text-muted",children:"There are no investment rounds for this company yet."})]}):(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)("table",{className:"table table-hover",children:[(0,i.jsx)("thead",{className:"table-light",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Round Details"}),(0,i.jsx)("th",{children:"Investment Summary"}),(0,i.jsx)("th",{children:"Investors"}),(0,i.jsx)("th",{children:"Status"}),(0,i.jsx)("th",{children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(((e,s)=>{const t=Object.keys(f)[s],a=e.totalInvestors>0?Math.round(e.confirmedInvestors/e.totalInvestors*100):0;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"fw-semibold",children:e.name}),(0,i.jsx)("div",{className:"text-muted small",children:e.company_name}),(0,i.jsxs)("div",{className:"text-muted small",children:[e.shareClassType," \u2022 ",e.instrumentType]})]})}),(0,i.jsx)("td",{children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"fw-semibold",children:T(e.totalInvestment,e.currency)}),(0,i.jsxs)("div",{className:"text-muted small",children:["Confirmed: ",T(e.confirmedInvestment,e.currency)]}),(0,i.jsxs)("div",{className:"text-muted small",children:[Math.round(e.totalShares).toLocaleString()," shares"]})]})}),(0,i.jsx)("td",{children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"fw-semibold",children:[e.totalInvestors," investor",1!==e.totalInvestors?"s":""]}),(0,i.jsxs)("div",{className:"text-muted small",children:[e.confirmedInvestors," confirmed \u2022 ",e.pendingInvestors," pending"]})]})}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{children:100===a?(0,i.jsxs)("span",{className:"badge bg-success",children:[(0,i.jsx)("i",{className:"fas fa-check-circle me-1"})," Complete (",a,"%)"]}):a>0?(0,i.jsxs)("span",{className:"badge bg-warning text-dark",children:[(0,i.jsx)("i",{className:"fas fa-clock me-1"})," In Progress (",a,"%)"]}):(0,i.jsxs)("span",{className:"badge bg-secondary",children:[(0,i.jsx)("i",{className:"fas fa-hourglass-start me-1"})," Not Started"]})})}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:"btn-group",role:"group",children:(0,i.jsxs)("button",{className:"btn btn-sm btn-primary",onClick:()=>D(t),title:"View Investors",children:[(0,i.jsx)("i",{className:"fas fa-eye me-1"})," View Investors"]})})})]},t)}))})]})})})()})]})]})})]})]})}),(0,i.jsx)(c,{show:y,onClose:()=>{I(!1),w(null),F([])},roundData:S,investors:_,onUpdateStatus:async(e,t)=>{try{if((await o.A.post(C+"updateInvestmentStatus",{request_id:e,status:t,updated_by_id:s.id},{headers:{Accept:"application/json","Content-Type":"application/json"}})).data.message){if(R(),S){const s=Object.keys(f).find((s=>f[s].investors.some((s=>s.id===e))));s&&y&&D(s)}alert(`Investment ${"Yes"===t?"approved":"Rejected"===t?"rejected":"marked as pending"} successfully`)}}catch(j){console.error("Error updating investment status:",j),alert("Failed to update investment status")}}})]})}}}]);
//# sourceMappingURL=7954.149a501a.chunk.js.map