"use strict";(self.webpackChunkamourette=self.webpackChunkamourette||[]).push([[6174],{6174:(e,s,t)=>{t.d(s,{A:()=>j});var a=t(5043),r=t(6213),n=t(4117),o=t(2862),l=t(5475),i=t(3538),c=t(4258),d=t(8908),m=t(793),u=t(3156),p=t(2074),g=t(4808),h=t(9649),f=t(4241),x=t(579);const j=e=>{let{isOpen:s,onClose:j,children:v,userdetail:k,userChatDetail:N,LoginData:y,to_id:b,getChatAfterSave:w,refreshchat:_}=e;const C=(0,a.useRef)(!0),S=(0,a.useRef)(null),[E,A]=(0,a.useState)(""),[L,q]=(0,a.useState)(!1),[I,R]=(0,a.useState)(""),[T,F]=(0,a.useState)(""),[J,O]=(0,a.useState)([]),[M,D]=(0,a.useState)(!1),[W,$]=(0,a.useState)(""),[P,H]=(0,a.useState)([]),[U,V]=(0,a.useState)([]),[G,B]=(0,a.useState)(""),[z,K]=(0,a.useState)(!1),[Y,Z]=(0,a.useState)(y),[Q,X]=(0,a.useState)(!1),[ee,se]=(0,a.useState)(""),te="https://backend.amourette.no/api/members/",[ae,re]=(0,a.useState)(!1),[ne,oe]=(0,a.useState)(!1),[le,ie]=(0,a.useState)(""),[ce,de]=(0,a.useState)(!1),[me,ue]=(0,a.useState)(!1),{t:pe}=(0,n.Bd)(),[ge,he]=(0,a.useState)(null),[fe,xe]=(0,a.useState)(""),[je,ve]=(0,a.useState)([]),[ke,Ne]=(0,a.useState)(N),ye=(0,a.useRef)(null),be=(0,a.useRef)(null),we=localStorage.getItem("userLogin"),[_e,Ce]=(we&&JSON.parse(we),(0,a.useState)(!1)),[Se,Ee]=(0,a.useState)(0),[Ae,Le]=(0,a.useState)(!0),[qe,Ie]=(0,a.useState)(!1);(0,a.useEffect)((()=>{ve(N)}),[N]),(0,a.useEffect)((()=>{}),[]),(0,a.useEffect)((()=>{const e=localStorage.getItem("language")||"en";o.A.language!==e&&o.A.changeLanguage(e)}),[o.A,pe]);const Re=e=>{"Escape"===e.key&&null===ge&&j()};(0,a.useEffect)((()=>(document.addEventListener("keydown",Re),()=>{document.removeEventListener("keydown",Re)})),[ge]),(0,a.useEffect)((()=>{const e=e=>{"Escape"===e.key&&he(null)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[he]);const[Te,Fe]=(0,a.useState)(!1),Je=()=>{Fe(!1),ls(!1)},Oe=e=>{Fe(Te===e?null:e)},[Me,De]=(0,a.useState)(!1),We=(0,a.useRef)(null);(0,a.useEffect)((()=>{const e=e=>{We.current&&!We.current.contains(e.target)&&De(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);(0,a.useEffect)((()=>{Z(y),B(b),s&&(Ne(N),setTimeout((()=>{const e=be.current;e&&(e.scrollTop=e.scrollHeight),oe(!1),cs()}),100))}),[s,N,y]),(0,a.useEffect)((()=>{const e=e=>{"Escape"===e.key&&he(null)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[he]),(0,a.useEffect)((()=>{const e=localStorage.getItem("userLogin"),s=e?JSON.parse(e):null;s.id;if(s&&b){var t=Number(b);V([s.id,t])}}),[b]),(0,a.useEffect)((()=>{""!==b&&$e(),console.log(b)}),[b]);const $e=async()=>{const e=localStorage.getItem("userLogin"),s=e?JSON.parse(e):null;let t={to_id:b,user_id:s.id};try{const e=await r.A.post(te+"getmessageCount",t,{headers:{Accept:"application/json","Content-Type":"application/json"}});console.log("dd",e.data);var a=e.data.results;const s=localStorage.getItem("userLogin"),n=(s&&JSON.parse(s),a.filter((e=>"No"===e.read)).length);console.log(n),A(n)}catch(n){n.response?console.error("Response error:",n.response):n.request?console.error("Request error:",n.request):console.error("General error:",n.message)}};(0,a.useEffect)((()=>{const e=new WebSocket("wss://backend.amourette.no");return e.onmessage=e=>{try{const s=JSON.parse(e.data);if(!s)return void console.error("Received invalid JSON:",e.data);console.log(s);const t=Number(s.user_id),a=Number(s.to_id),r=Number(y.id);Number(b);"DeleteChatMessage"===s.event&&U.includes(t)&&U.includes(a)&&(Be(s.id),_()),"DeleteChatMessage_other"===s.event&&r===t&&(Be(s.id),_()),s.event,"DeleteChatMessageMultiple"===s.event&&U.includes(t)&&U.includes(a)&&(ze(s.id),_()),"ChatMessage"===s.event&&U.includes(t)&&U.includes(a)&&(Ke(s,t,a),r===t?setTimeout((()=>{S.current.scrollIntoView({behavior:"smooth",block:"nearest"})}),350):console.log("This is a receiver's message:",s)),U.includes(t)&&U.includes(a)?"DeleteChatMessageMultiple"!==s.event&&"DeleteChatMessage"!==s.event&&"DeleteChatMessage_other"!==s.event&&(r===t?S.current.scrollIntoView({behavior:"smooth",block:"nearest"}):console.log("This is a receiver's message:",s)):console.log("Message ignored for this user:",r)}catch(le){console.error("Failed to parse WebSocket message:",le),console.error("Raw message:",e.data)}},()=>{e.close()}}),[y,b,U]);const Pe=async()=>{const e=be.current;if(!e||C.current)return;const s=e.scrollTop<=5,t=e.scrollHeight-e.scrollTop-e.clientHeight<=50;if(console.log(s),s&&Ae&&!qe){e.scrollHeight;await(async e=>{Ie(!0);const s=localStorage.getItem("userLogin");let t={user_id:(s?JSON.parse(s):null).id,to_id:b,offset:e};try{const e=(await r.A.post(te+"getuserChatmessage",t,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data.results;console.log(e),Ne(e),ve(e)}catch(le){console.error("Error fetching messages",le)}Ie(!1)})(Se)}if(oe(t),t){oe(!0),is();const e=localStorage.getItem("userLogin"),s=e?JSON.parse(e):null;if(""!==b){let e={user_id:s.id,to_id:b};try{"1"===(await r.A.post(te+"messageseen",e,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data.status&&He(b),$e()}catch(a){a.response?console.error("Error response:",a.response):a.request?console.error("Request data:",a.request):console.error("Error message:",a.message)}}}},He=async e=>{const s=localStorage.getItem("userLogin"),t=s?JSON.parse(s):null;if(!t||!t.id)return void console.error("Login data is not available");let a={user_id:t.id,to_id:e,offset:0};try{(await r.A.post(te+"getuserChatmessage",a,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data.results}catch(n){n.response?console.error("Error response:",n.response):n.request?console.error("Request data:",n.request):console.error("Error message:",n.message)}};(0,a.useEffect)((()=>{(async()=>{const e=localStorage.getItem("userLogin");let s={user_id:(e?JSON.parse(e):null).id,to_id:b};try{const e=await r.A.post(te+"checkuserblock",s,{headers:{Accept:"application/json","Content-Type":"application/json"}});console.log("checkblock"),console.log(e.data),e.data.result.length>0?q(!0):q(!1)}catch(t){t.response?console.error("Response error:",t.response):t.request?console.error("Request error:",t.request):console.error("General error:",t.message)}})()}),[]);const Ue=e=>{const s=new Date(e),t=new Date;let a=t.getFullYear()-s.getFullYear();const r=t.getMonth()-s.getMonth();return(r<0||0===r&&t.getDate()<s.getDate())&&a--,a},Ve=(!I.trim()&&P.length,["arse","arsehead","arsehole","ass","ass hole","asshole","bastard","bitch","bloody","bollocks","brotherfucker","bugger","bullshit","child-fucker","Christ on a bike","Christ on a cracker","cock","cocksucker","crap","cunt","dammit","damn","damned","damn it","dick","dick-head","dickhead","dumb ass","dumb-ass","dumbass","dyke","faggot","father-fucker","fatherfucker","fuck","fucker","fucking","god dammit","goddammit","God damn","god damn","goddamn","Goddamn","goddamned","goddamnit","godsdamn","holy shit","horseshit","in shit","jackarse","jack-ass","jackass","Jesus Christ","Jesus fuck","Jesus Harold Christ","Jesus H. Christ","Jesus, Mary and Joseph","Jesus wept","kike","mother fucker","mother-fucker","motherfucker","nigga","nigra","pigfucker","piss","prick","pussy","shit","shit ass","shite","sibling fucker","sisterfuck","sisterfucker","slut","son of a bitch","son of a whore","spastic","sweet Jesus","twat","wanker"]),Ge=e=>new Promise(((s,t)=>{const a=new FileReader;a.onload=function(a){const r=new Image;r.onload=function(){const a=document.createElement("canvas");a.width=r.width,a.height=r.height;a.getContext("2d").drawImage(r,0,0),a.toBlob((a=>{if(a){const t=new File([a],e.name.replace(/\.\w+$/,".png"),{type:"image/png",lastModified:(new Date).getTime()});s(t)}else t(new Error("Failed to convert image."))}),"image/png",1)},r.onerror=t,r.src=a.target.result},a.onerror=t,a.readAsDataURL(e)})),Be=e=>{ve((s=>s.filter((s=>s.id!==e))))},ze=e=>{ve((s=>s.filter((s=>!e.includes(s.id)))))},Ke=async(e,s,t)=>{let a={data:e,user_id:s,to_id:t};console.log(a,"que");try{const e=await r.A.post(te+"getSEndMessagequick",a,{headers:{Accept:"application/json","Content-Type":"application/json"}});var n=e.data.results;console.log(n,"check");const s=localStorage.getItem("userLogin");if(t===(s?JSON.parse(s):null).id&&n.length>0){const e=n.filter((e=>"No"===e.read)).length;console.log(e),$e()}e.data&&Array.isArray(e.data.results)?(ve((s=>[...s,...e.data.results])),Ne(e.data.results)):console.error("No valid results found in the response:",e.data)}catch(o){o.response?console.error("Response error:",o.response):o.request?console.error("Request error:",o.request):console.error("General error:",o.message)}},Ye=e=>{if(!e)return null;const s=e.replace(/Z$/,""),t=f.c9.fromISO(s,{zone:"Europe/Oslo"});if(!t.isValid)return console.error("Invalid Oslo Time:",t.invalidExplanation),"Invalid Date";return t.setZone(Intl.DateTimeFormat().resolvedOptions().timeZone).toFormat("LLL dd, yyyy, hh:mm a")},Ze=async e=>{let s={id:e,user_id:y.id,to_id:b};try{await r.A.post(te+"deletemessagechat",s,{headers:{Accept:"application/json","Content-Type":"application/json"}});Fe(!1)}catch(t){t.response||(t.request?console.error("Request data:",t.request):console.error("Error message:",t.message))}},[Qe,Xe]=(0,a.useState)([]),[es,ss]=(0,a.useState)(!1),[ts,as]=(0,a.useState)(!1),rs=e=>{Xe((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]))},ns=e=>[".png",".jpg",".jpeg",".gif"].some((s=>e.endsWith(s)))?e:null;(0,a.useEffect)((()=>{J.length>0||Qe.length>0?ss(!0):ss(!1)}),[J,Qe]);const[os,ls]=(0,a.useState)(!1),is=async()=>{if(console.log(b),!b||ne)return;const e=localStorage.getItem("userLogin");let s={user_id:(e?JSON.parse(e):null).id,to_id:b};console.log(s);try{await r.A.post(te+"messageseenall",s,{headers:{Accept:"application/json","Content-Type":"application/json"}});console.log("Seen API response received"),setTimeout((()=>{S.current&&S.current.scrollIntoView({behavior:"smooth",block:"end"})}),350),$e()}catch(t){t.response?console.error("Error response:",t.response):t.request?console.error("Request data:",t.request):console.error("Error message:",t.message)}},cs=async()=>{if(!b||ne)return;const e=localStorage.getItem("userLogin");let s={user_id:(e?JSON.parse(e):null).id,to_id:b};console.log(s);try{await r.A.post(te+"messageseenall",s,{headers:{Accept:"application/json","Content-Type":"application/json"}});console.log("Seen API response received"),$e()}catch(t){t.response?console.error("Error response:",t.response):t.request?console.error("Request data:",t.request):console.error("Error message:",t.message)}};(0,a.useEffect)((()=>{if(!s)return;const e=be.current;if(!e)return;const t=()=>Pe();C.current=!0;const a=setTimeout((()=>{C.current=!1}),300);return e.addEventListener("scroll",t),()=>{clearTimeout(a),e.removeEventListener("scroll",t)}}),[s,ne,Se,Ae,qe]);return s?(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)("div",{className:"popup-overlay checkbox",onClick:e=>{e.target.classList.contains("popup-overlay")&&j()},children:[M&&(0,x.jsx)(d.A,{message:W}),Q&&(0,x.jsx)(m.A,{message:ee}),(0,x.jsx)("div",{className:"popup-content col-md-4",children:(0,x.jsxs)("div",{className:"d-flex flex-column gap-0 chat_box",children:[(0,x.jsxs)("div",{className:"d-flex align-items-center gap-3 mess_head ",children:[(0,x.jsx)(l.N_,{target:"_blank",to:`/friend/${k.id}`,className:"d-block chat_profile",children:k.profile_image&&0===k.makeImagePrivate?(0,x.jsx)("img",{className:"w-100 h-100",src:k.profile_image,alt:"userpic"}):(0,x.jsx)("img",{className:"w-100 h-100",src:t(7123),alt:"userpic"})}),(0,x.jsxs)("div",{className:"d-flex flex-md-row flex-column align-items-md-center justify-content-between w-100 gap-2 chat_name pt-3",children:[(0,x.jsx)("div",{className:"d-flex flex-column gap-3",children:(0,x.jsxs)("div",{className:"d-flex flex-column gap-1",children:[(0,x.jsxs)("div",{className:"d-flex align-items-md-center gap-2",children:[(0,x.jsx)("div",{className:"newclass",children:(0,x.jsx)(l.N_,{target:"_blank",className:"unamecolor",to:`/friend/${k.id}`,children:k.username})}),",",(0,x.jsx)("p",{children:"Couple"===k.gender?`${Ue(k.birthday_date)} & ${Ue(k.birthday_date_her)}`:k.birthday_date?`${Ue(k.birthday_date)}`:""})]}),(0,x.jsx)("h5",{children:k.location})]})}),(0,x.jsxs)("div",{className:"d-flex flex-column justify-content-end align-items-end gap-2",children:[(0,x.jsxs)("div",{className:"search-box",children:[(0,x.jsx)("i",{className:"fas fa-search"}),(0,x.jsx)("input",{type:"search",placeholder:pe("searchaaa"),onInput:e=>(e=>{const s=e.target.value.toLowerCase();if(xe(s),!s)return void ve(N);const t=N.filter((e=>e&&e.message&&e.message.toLowerCase().includes(s)));ve(t)})(e)})]}),(0,x.jsxs)("div",{className:"d-flex align-items-center gap-2 message_s-btn",children:[es&&(0,x.jsx)("button",{className:"deltebtn",type:"button",onClick:async()=>{let e={id:Qe,user_id:y.id,to_id:b,other_id:J};try{await r.A.post(te+"deletemultiplemessagechat",e,{headers:{Accept:"application/json","Content-Type":"application/json"}});Xe([]),ss(!1),as(!1),O([]),ss(!1)}catch(s){s.response||(s.request?console.error("Request data:",s.request):console.error("Error message:",s.message))}},children:pe("delete")}),(0,x.jsx)("button",{className:"select_btn "+(ts?"active":""),type:"button",onClick:()=>{as(!ts)},children:pe("Select")})]})]})]})]}),(0,x.jsxs)("div",{className:"mess_box_main",ref:be,style:{maxHeight:"56vh",overflow:"auto",display:"flex",flexWrap:"wrap",justifyContent:"end"},children:[(0,x.jsxs)("div",{className:"mess_box d-flex flex-column gap-3 justify-content-end w-100",children:[qe&&(0,x.jsx)("div",{className:"text-center w-100 py-2",children:(0,x.jsx)("span",{className:"spinner-border text-success spinner-border-sm",role:"status","aria-hidden":"true"})}),0===je.length?(0,x.jsx)("div",{className:"empty-chat-message",children:(0,x.jsx)("p",{children:pe("No_messages_to_display")})}):je.map(((e,s)=>(0,x.jsx)("div",{ref:s===je.length-1?S:null,children:e.user_id===y.id?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"main_mess right_mess d-flex align-items-end gap-2 flex-column",children:Array.isArray(JSON.parse(e.file))&&JSON.parse(e.file).length>0&&(0,x.jsxs)(x.Fragment,{children:[0===s&&(0,x.jsx)(l.N_,{target:"_blank",to:`/friend/${e.user1_id}`,className:"d-block mess_profile",children:(0,x.jsx)("img",{className:"w-100 h-100 pr",src:1===e.user1_makeImagePrivate?t(7123):e.user1_profile,alt:"profile"})}),JSON.parse(e.file).map(((t,a)=>{const r=ns(t);return(0,x.jsx)("div",{className:"message d-block send_image",children:r?(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)("div",{className:"d-flex align-items-start gap-1 h-100",children:[(0,x.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,x.jsx)("button",{className:"remove_mess",onClick:()=>Oe(s),children:(0,x.jsx)(i.Kak,{})}),Te===s&&(0,x.jsxs)("ul",{className:"popup-menu",children:[(0,x.jsx)("li",{onClick:()=>Ze(e.id),children:pe("Remove")}),(0,x.jsx)("li",{onClick:Je,children:pe("Cancel")})]})]}),(0,x.jsxs)("div",{className:"d-flex flex-column gap-1 justify-content-end align-items-end",children:[(0,x.jsxs)("div",{className:"d-flex align-items-start gap-1 5",children:[(0,x.jsx)("img",{className:"w-100 h-100 d",src:r,alt:`file-${a}`,onClick:()=>he(r),style:{cursor:"pointer"}}),ts&&(0,x.jsx)("input",{type:"checkbox",checked:Qe.includes(e.id),onChange:()=>rs(e.id)})]}),(0,x.jsx)("span",{children:Ye(e.date)})]})]})}):(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)("div",{className:"d-flex align-items-start gap-1 h-100",children:[(0,x.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,x.jsx)("button",{className:"remove_mess",onClick:()=>Oe(s),children:(0,x.jsx)(i.Kak,{})}),Te===s&&(0,x.jsxs)("ul",{className:"popup-menu",children:[(0,x.jsx)("li",{onClick:()=>Ze(e.id),children:pe("Remove")}),(0,x.jsx)("li",{onClick:Je,children:pe("Cancel")})]})]}),(0,x.jsxs)("div",{className:"d-flex flex-column gap-1 justify-content-end align-items-end",children:[(0,x.jsxs)("div",{className:"d-flex align-items-start gap-1 6",children:[(0,x.jsx)(g.A,{url:t,onClick:()=>he(t)}),ts&&(0,x.jsx)("input",{type:"checkbox",checked:Qe.includes(e.id),onChange:()=>rs(e.id)})]}),(0,x.jsx)("span",{children:Ye(e.date)})]})]})})},a)}))]})}),e.message&&"null"!==e.message&&(0,x.jsxs)("div",{className:"main_mess right_mess d-flex align-items-center gap-2",children:[(0,x.jsx)(l.N_,{target:"_blank",to:`/friend/${e.user1_id}`,className:"d-block mess_profile ri",children:(0,x.jsx)("img",{className:"w-100 h-100 ri",src:1===e.user1_makeImagePrivate?t(7123):e.user1_profile,alt:"profile"})}),(0,x.jsxs)("div",{className:" d-flex flex-column gap-1 justify-content-end align-items-end",children:[(0,x.jsxs)("div",{className:"d-flex align-items-start gap-0",children:[(0,x.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,x.jsx)("button",{className:"remove_mess",onClick:()=>Oe(s),children:(0,x.jsx)(i.Kak,{})}),Te===s&&(0,x.jsxs)("ul",{className:"popup-menu",children:[(0,x.jsx)("li",{onClick:()=>Ze(e.id),children:pe("Remove")}),(0,x.jsx)("li",{onClick:Je,children:pe("Cancel")})]})]}),(0,x.jsxs)("div",{className:"d-flex align-items-start gap-1 1",children:[(0,x.jsx)("p",{className:"message",children:e.message}),ts&&(0,x.jsx)("input",{type:"checkbox",checked:Qe.includes(e.id),onChange:()=>rs(e.id)})]})]}),(0,x.jsx)("span",{children:Ye(e.date)})]})]})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"main_mess left_mess d-flex align-items-start gap-2 flex-column ",children:Array.isArray(JSON.parse(e.file))&&JSON.parse(e.file).length>0&&(0,x.jsxs)(x.Fragment,{children:[0===s&&(0,x.jsx)(l.N_,{target:"_blank",to:`/friend/${e.user1_id}`,className:"d-block mess_profile le flex-shrink-0",children:(0,x.jsx)("img",{className:"w-100 h-100 d",src:1===e.user1_makeImagePrivate?t(7123):e.user1_profile,alt:"profile"})}),JSON.parse(e.file).map(((s,t)=>{const a=ns(s);return(0,x.jsx)("div",{className:"message d-block send_image",children:a?(0,x.jsx)(x.Fragment,{children:(0,x.jsx)("div",{className:"d-flex align-items-start gap-1 h-100",children:(0,x.jsxs)("div",{className:"d-flex flex-column gap-1 justify-content-end align-items-end",children:[(0,x.jsx)("div",{className:"d-flex align-items-start gap-1 2",children:(0,x.jsx)("img",{className:"w-100 h-100 d",src:a,alt:`file-${t}`,onClick:()=>he(a),style:{cursor:"pointer"}})}),(0,x.jsx)("span",{children:Ye(e.date)})]})})}):(0,x.jsx)(x.Fragment,{children:(0,x.jsx)("div",{className:"d-flex align-items-start gap-1 h-100",children:(0,x.jsxs)("div",{className:"d-flex flex-column gap-1 justify-content-end align-items-end",children:[(0,x.jsx)("div",{className:"d-flex align-items-start gap-1 3",children:(0,x.jsx)(g.A,{url:s,onClick:()=>he(s)})}),(0,x.jsx)("span",{children:Ye(e.date)})]})})})},t)}))]})}),e.message&&"null"!==e.message&&(0,x.jsxs)("div",{className:"main_mess left_mess d-flex align-items-center gap-2",children:[(0,x.jsx)(l.N_,{target:"_blank",to:`/friend/${e.user1_id}`,className:"d-block mess_profile le  flex-shrink-0",children:(0,x.jsx)("img",{className:"w-100 h-100 pr",src:1===e.user1_makeImagePrivate?t(7123):e.user1_profile,alt:"profile"})}),(0,x.jsxs)("div",{className:" d-flex flex-column gap-1 justify-content-start align-items-start",children:[(0,x.jsx)("div",{className:"d-flex align-items-start gap-0",children:(0,x.jsx)("div",{className:"d-flex align-items-start gap-1 4",children:(0,x.jsx)("p",{className:"message",children:e.message})})}),(0,x.jsx)("span",{children:Ye(e.date)})]})]})]})},s)))]}),je.length>4&&!ne&&(0,x.jsxs)("button",{className:"newmessagearrow",type:"button",onClick:async()=>{if(console.log(b),!b)return;const e=localStorage.getItem("userLogin");let s={user_id:(e?JSON.parse(e):null).id,to_id:b};console.log(s);try{await r.A.post(te+"messageseenall",s,{headers:{Accept:"application/json","Content-Type":"application/json"}});console.log("ll"),setTimeout((()=>{const e=be.current;e&&(e.scrollTop=e.scrollHeight),setTimeout((()=>{oe(!0)}),350)}),30),$e()}catch(t){t.response?console.error("Error response:",t.response):t.request?console.error("Request data:",t.request):console.error("Error message:",t.message)}},children:[(0,x.jsx)(u.BNo,{}),E>0&&(0,x.jsx)("span",{children:E})]})]}),ge&&(0,x.jsx)("div",{className:"p-5",style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:989898},onClick:()=>he(null),children:(0,x.jsxs)("div",{className:"rel d-block h-100",children:[(0,x.jsx)("button",{type:"button",className:"closebtnpic",children:(0,x.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"icon icon-tabler icons-tabler-outline icon-tabler-x",children:[(0,x.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),(0,x.jsx)("path",{d:"M18 6l-12 12"}),(0,x.jsx)("path",{d:"M6 6l12 12"})]})}),(0,x.jsx)(p.A,{className:"w-100 h-100 object-fit-cover",url:ge,style:{maxWidth:"100%",maxHeight:"100%",borderRadius:"10px",height:"85vh",objectFit:"contain"}})]})}),(0,x.jsx)("span",{className:"text-danger",children:le}),me&&(0,x.jsx)("span",{className:"text-danger",children:pe("Your_message_contain")}),(0,x.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(""!==I.trim()||P.length>0)&&(async()=>{if(Fe(!1),!0===L)D(!0),$("User is blocked"),setTimeout((()=>{D(!1),$("")}),1e3);else{oe(!0);const a=new FormData;de(!0);var e=null===I||void 0===I?void 0:I.trim();if(console.log(e),""!==e){const n=(s=e).trim()?s.split(/\s+/).length:0;if(n<2e3){a.append("message",I),a.append("fileType","chats"),a.append("user_id",y.id),a.append("to_id",b),P.forEach((e=>{a.append("files",e)})),console.log("Message:",I),console.log("Files:",P);try{const e=await r.A.post(te+"saveUserChat",a,{headers:{Accept:"application/json","Content-Type":"multipart/form-data"}});de(!1),e.data,S.current&&S.current.scrollIntoView({behavior:"smooth",block:"nearest"}),setTimeout((()=>{S.current&&S.current.scrollIntoView({behavior:"smooth",block:"nearest"}),setTimeout((()=>{oe(!0)}),50)}),500)}catch(t){t.response?console.error("Response error:",t.response):t.request?console.error("Request error:",t.request):console.error("General error:",t.message)}R(""),H([])}else de(!1),D(!0),$(`Comment cannot exceed 2000 words. Currently: ${n} words.`),setTimeout((()=>{D(!1),$("")}),1e3)}else{a.append("message",I),a.append("fileType","chats"),a.append("user_id",y.id),a.append("to_id",b),P.forEach((e=>{a.append("files",e)})),console.log("Message:",I),console.log("Files:",P);try{const e=await r.A.post(te+"saveUserChat",a,{headers:{Accept:"application/json","Content-Type":"multipart/form-data"}});de(!1),e.data,S.current&&S.current.scrollIntoView({behavior:"smooth",block:"nearest"}),setTimeout((()=>{S.current&&S.current.scrollIntoView({behavior:"smooth",block:"nearest"})}),500)}catch(t){t.response?console.error("Response error:",t.response):t.request?console.error("Request error:",t.request):console.error("General error:",t.message)}R(""),H([])}}var s})()},className:"message_type d-flex align-items-center gap-2",children:[(0,x.jsxs)("div",{className:"d-block image_img",children:[(0,x.jsx)("input",{type:"file",onChange:async e=>{const s=Array.from(e.target.files),t=[],a=[];for(const n of s){const e=n.type.startsWith("image/");n.type.startsWith("video/");if(n.size/1024/1024>25)a.push(`${n.name} exceeds 25 MB.`);else{if(e){if(!["image/jpeg","image/png","image/gif"].includes(n.type))try{const e=await Ge(n);t.push(e);continue}catch(r){console.error("Image conversion error:",r),a.push(`Failed to convert ${n.name}`);continue}}t.push(n)}}if(a.length>0?ie(`Some files were not added:\n${a.join("\n")}`):ie(""),Ce(!0),K(!0),H((e=>[...e,...t])),ye.current){ye.current.focus();const e=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,bubbles:!0});ye.current.dispatchEvent(e)}},multiple:!0}),(0,x.jsx)("img",{className:"w-100 h-100",src:t(3355),alt:"Upload"})]}),(0,x.jsxs)("div",{className:"emoji-container emchatbox",ref:We,children:[(0,x.jsx)("button",{type:"button",className:"emoji-button",onClick:()=>De(!Me),children:"\ud83d\ude00"}),Me&&(0,x.jsx)(c.Ay,{onEmojiClick:e=>{R((s=>s+e.emoji)),ye.current&&ye.current.focus(),Ce(!0),De(!1)}})]}),(0,x.jsx)("input",{type:"text",ref:ye,value:I,onChange:e=>{const s=e.target.value;R(s),""!==s.trim()?K(!0):K(!1);const t=Ve.some((e=>s.toLowerCase().includes(e.toLowerCase())));Ce(!0),ue(!!t)},placeholder:"Write a message..."}),(0,x.jsx)("button",{className:"d-block image_img",type:"submit",disabled:!I.trim()&&0===P.length,children:(0,x.jsx)("img",{className:"w-50 h-50",src:t(1145),alt:"Send"})}),ce&&(0,x.jsx)("div",{className:"spinner-border text-success send_load",role:"status",children:(0,x.jsx)("span",{className:"visually-hidden"})}),P.length>0&&(0,x.jsx)("div",{className:"muti_images",children:(0,x.jsx)("div",{className:"muti_main overflow-auto d-flex gap-2 mx-auto w-96",children:P.map(((e,s)=>{const t=e.type.startsWith("image/"),a=e.type.startsWith("video/");return(0,x.jsxs)("div",{className:"d-block muti_image",children:[t&&(0,x.jsx)("img",{className:"w-100 h-100",src:URL.createObjectURL(e),alt:"Preview"}),a&&(0,x.jsx)("video",{className:"w-100 h-100",controls:!0,src:URL.createObjectURL(e)}),!t&&!a&&(0,x.jsxs)("div",{className:"file-placeholder",children:[(0,x.jsx)("img",{src:h,alt:"File",className:"w-100 h-100"}),(0,x.jsx)("p",{className:"sendf",children:e.name})]}),(0,x.jsx)("button",{className:"delete_img",onClick:()=>(e=>{H((s=>s.filter(((s,t)=>t!==e))))})(s),children:"\xd7"})]},s)}))})})]})]})})]})}):null}},4808:(e,s,t)=>{t.d(s,{A:()=>l});var a=t(5043),r=t(5475),n=t(9649),o=t(579);const l=e=>{let{url:s,onClick:t,className:l}=e;const[i,c]=(0,a.useState)(null),[d,m]=(0,a.useState)(!1),[u,p]=(0,a.useState)(null);return(0,a.useEffect)((()=>{const e=navigator.userAgent||"";/iPhone|iPad|iPod/i.test(e)&&m(!0)}),[]),(0,a.useEffect)((()=>{if(!s)return;const e=s.split(".").pop().toLowerCase();d&&"avif"===e?fetch(s).then((e=>e.blob())).then((e=>{const s=new FileReader;s.onloadend=()=>{p(s.result),c("image")},s.onerror=()=>c("file"),s.readAsDataURL(e)})).catch((()=>c("file"))):["jpg","jpeg","png","gif","webp","avif"].includes(e)?c("image"):["mp4","webm","ogg","mov"].includes(e)?c("video"):c("file")}),[s,d]),i?(0,o.jsx)(o.Fragment,{children:"image"===i?d&&s.endsWith(".avif")?(0,o.jsx)("img",{src:u||"",alt:"media",className:l,style:{maxWidth:"100%"},onClick:t}):(0,o.jsxs)("picture",{children:[s.endsWith(".avif")&&(0,o.jsx)("source",{srcSet:s,type:"image/avif"}),(0,o.jsx)("img",{src:s.endsWith(".avif")?s.replace(".avif",".jpg"):s,alt:"media",className:l,style:{maxWidth:"100%"},onClick:t})]}):"video"===i?(0,o.jsx)("video",{controls:!0,style:{maxWidth:"100%",cursor:"pointer"},className:l,onClick:t,children:(0,o.jsx)("source",{src:s})}):(0,o.jsx)(r.N_,{to:s,download:!0,target:"_blank",title:"File",rel:"noopener noreferrer",className:"h-100 d-inline-block chatfiles",children:(0,o.jsx)("img",{src:n,alt:"File",style:{maxWidth:"100%"}})})}):(0,o.jsx)(o.Fragment,{})}},9649:(e,s,t)=>{e.exports=t.p+"static/media/documents.39e7035f6d13452f3043.png"},1145:(e,s,t)=>{e.exports=t.p+"static/media/send.70b861efdc3139bb3a36.png"},3355:(e,s,t)=>{e.exports=t.p+"static/media/serach2.9f9d40152f2832cac4bd.png"}}]);
//# sourceMappingURL=6174.4244a051.chunk.js.map